FramePackLoop

FramePackLoop 是基于 lllyasviel 开发的 lllyasviel/FramePack 软件，专为循环动画功能进行扩展的增强版本。

请注意：本功能属于 FramePack 基础功能的实验性扩展，未来可能会停止维护，请务必知悉。

开发背景

循环动画广泛应用于视频等待界面、动态背景、表情贴图等场景。  
虽然原版 FramePack 已支持通过单张图像生成动画，但其默认实现无法自然衔接动画的首尾帧，难以满足循环动画的制作需求。

尽管部分支持关键帧设定的软件正在开发中，但仅简单地将首尾设为相同图像仍会导致循环卡顿。

FramePackLoop 通过活用 FramePack 的核心技术，  
重点验证了如何实现首尾帧无缝衔接的可行性方案。

核心原理

FramePackLoop 通过以下四步生成循环动画：

1. 生成主体动画片段
2. 创建首尾衔接过渡动画
3. 合并为完整单循环动画
4. 复制生成最终循环动画

本软件采用「节数」(Section) 而非秒作为时长单位，  
1 节约等于 1 秒（非精确对应）。

参数说明

相较于原版 FramePack，新增/调整了以下参数：

![FramePackLoop参数界面](images/image.png)

• 主体动画节数  

  控制主体动画的节数长度。

• 衔接动画节数  

  建议与主体节数相同，但减少节数仍可运行。

> 总动画时长 =  
> `主体节数 + 衔接节数`  
> 例：主体1节 + 衔接1节 ≈ 2秒

• 缓冲节数  

  • `0`：立即开始循环动画  

  • `非0`：添加起始缓冲动画（推荐1-3节）  

  （使用预设图像时建议启用）

• 循环次数  

  基于单循环视频的复制生成，  
  大幅增加次数也不会明显延长处理时间。

输出文件

`output` 文件夹将生成以下文件（其余可安全删除）：

• `XXXX_1loop.mp4`  

  • 单循环视频文件，可通过编辑软件设置循环播放  

  （经测试 CapCut 和 OBS Studio 兼容性良好）

• `XXXX_loop_{循环次数}.mp4`  

  • 预拼接好的长版循环视频


安装与运行

安装方式与原版 FramePack 一致，  
环境配置完成后执行：

```bash
python demo_gradio_loop.py
```

已安装原版的用户，将 demo_gradio_loop.py 放置于原版 demo_gradio.py 同级目录后运行即可。

技术实现

本方案的核心创新在于「衔接动画」生成机制：  
原版 FramePack 在生成每节动画时，会参考输入图像和「后续节数」的未来帧信息。

FramePackLoop 在生成衔接动画时，  
创新性地同时引入「前一节历史帧」的参考机制（※待验证）。

针对循环动画场景，时空参照关系如下：
• 未来帧：指向主体动画起始段  

• 历史帧：指向主体动画结束段  


实验证明，在原版未来帧机制基础上叠加历史帧参照，  
配合原有的节间动画重叠(overlapping)技术，  
可显著提升循环流畅度（※尚未进行系统验证）。

未来计划

虽然未来可能加入 LoRA 适配或关键帧支持，  
但本项目的核心目标是验证「双向时空参照」机制，  
因此新功能暂无明确排期。

致谢

感谢 lllyasviel 的开源贡献！

